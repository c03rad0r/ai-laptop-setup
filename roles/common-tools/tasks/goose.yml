---
- name: Install dependencies for Goose
  apt:
    name:
      - curl
      - bzip2
    state: present

- name: Check if Goose is already installed
  stat:
    path: "{{ user_home }}/.local/bin/goose"
  register: goose_installed

- name: Install Goose
  shell: "curl -fsSL https://github.com/block/goose/releases/download/stable/download_cli.sh | CONFIGURE=false bash"
  when: not goose_installed.stat.exists
  args:
    creates: "{{ user_home }}/.local/bin/goose"

- name: Add Goose to PATH
  lineinfile:
    path: "{{ user_home }}/.bashrc"
    line: 'export PATH="$HOME/.local/bin:$PATH"'
    create: yes
  when: not goose_installed.stat.exists
